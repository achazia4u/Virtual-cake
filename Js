// When you want to start mic detection (e.g. after a click)
async function startBlowDetection() {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const mic = audioCtx.createMediaStreamSource(stream);
  const analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  mic.connect(analyser);

  const data = new Uint8Array(analyser.frequencyBinCount);
  const flames = document.querySelectorAll('.flame');
  let blown = false;

  function checkVolume() {
    analyser.getByteFrequencyData(data);
    const avg = data.reduce((sum, val) => sum + val, 0) / data.length;

    if (avg > 60 && !blown) { // threshold
      blown = true;
      flames.forEach(f => f.classList.add('extinguished'));
    }
    requestAnimationFrame(checkVolume);
  }

  checkVolume();
}
